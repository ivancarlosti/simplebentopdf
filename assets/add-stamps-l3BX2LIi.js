import"./lucide-iiCyoXQ9.js";import"./mobileMenu-95gHE_Cx.js";import"./full-width-B8_sb6NU.js";import"./version-CEpUk6qs.js";import{l as h,r as v}from"./shortcuts-CaOq6dM1.js";import{i as E}from"./shortcuts-init-cT1Qr9ko.js";let f=null,a=null,g=!1,l=null;const p=document.getElementById("pdfFile"),c=document.getElementById("fileList"),d=document.getElementById("stamp-viewer-container"),u=document.getElementById("viewer-card"),w=document.getElementById("save-stamped-btn"),y=document.getElementById("back-to-tools");function x(){if(!f){c.classList.add("hidden"),c.innerHTML="";return}c.classList.remove("hidden"),c.innerHTML="";const t=document.createElement("div");t.className="flex items-center justify-between bg-gray-700 p-3 rounded-lg mb-2";const e=document.createElement("span");e.className="truncate font-medium text-gray-200",e.textContent=f.name;const n=document.createElement("span");n.className="ml-3 text-gray-400 text-xs flex-shrink-0",n.textContent=h(f.size),t.append(e,n),c.appendChild(t)}async function P(t){if(!d)return;u&&u.classList.remove("hidden"),a&&a.parentElement===d&&d.removeChild(a),l&&(URL.revokeObjectURL(l),l=null),a=null,g=!1;const e=await v(t),n=new Blob([e],{type:"application/pdf"});l=URL.createObjectURL(n);try{const r=localStorage.getItem("pdfjs.preferences"),s=r?JSON.parse(r):{};delete s.annotationEditorMode;const m={...s,enablePermissions:!1};localStorage.setItem("pdfjs.preferences",JSON.stringify(m))}catch{}const o=document.createElement("iframe");o.className="w-full h-full border-0",o.allowFullscreen=!0;const i=new URL("/pdfjs-annotation-viewer/web/viewer.html",window.location.origin);o.src=`${i.toString()}?file=${encodeURIComponent(l)}`,o.addEventListener("load",()=>{b(o)}),d.appendChild(o),a=o}function b(t){try{const e=t.contentWindow,n=e?.document;if(!e||!n)return;(async()=>{try{const i=e.PDFViewerApplication;i?.initializedPromise&&await i.initializedPromise;const r=i?.eventBus;r&&typeof r._on=="function"&&r._on("annotationeditoruimanager",()=>{try{n.getElementById("editorStampButton")?.click()}catch{}});const s=n.querySelector(".PdfjsAnnotationExtension");s&&s.classList.add("PdfjsAnnotationExtension_Comment_hidden"),g=!0}catch(i){console.error("Failed to initialize annotation viewer for Add Stamps:",i)}})()}catch(e){console.error("Error wiring Add Stamps viewer:",e)}}async function B(t){f=t,x(),await P(t)}p&&p.addEventListener("change",async t=>{const e=t.target;if(e.files&&e.files.length>0){const n=e.files[0];await B(n)}});w&&w.addEventListener("click",()=>{if(!a){alert("Viewer not ready. Please upload a PDF and wait for it to finish loading.");return}try{const e=a.contentWindow?.pdfjsAnnotationExtensionInstance;if(e&&typeof e.exportPdf=="function"){const n=e.exportPdf();n&&typeof n.then=="function"&&n.catch(o=>{console.error("Error while exporting stamped PDF via annotation extension:",o)});return}alert("Could not access the stamped-PDF exporter. Please use the Export → PDF button in the viewer toolbar as a fallback.")}catch(t){console.error("Failed to trigger stamped PDF export:",t),alert("Could not export the stamped PDF. Please use the Export → PDF button in the viewer toolbar as a fallback.")}});y&&y.addEventListener("click",()=>{window.location.href="/"});E();
