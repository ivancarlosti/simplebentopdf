import{c as ne,i as ae}from"./lucide-iiCyoXQ9.js";import"./mobileMenu-95gHE_Cx.js";import"./full-width-B8_sb6NU.js";import"./version-CEpUk6qs.js";import{G as Fe,P as we,q as Te,u as _,v as k,T as Z,b as y,i as I,k as $e,g as Ae,w as M}from"./shortcuts-CaOq6dM1.js";import{i as De}from"./shortcuts-init-cT1Qr9ko.js";Fe.workerSrc=new URL("/assets/pdf.worker.min-qwK7q_zL.mjs",import.meta.url).toString();let F=[],R=null,H=0,P=null,Y=0,X=0,B=[],T=0,N=null,ee={width:612,height:792},te=1.333,O=!1,g=null,A=null,ie=0,le=0,j=0,V=0,se=0,re=0,D=null;const x=document.getElementById("pdfCanvas"),ce=document.getElementById("propertiesPanel"),Pe=document.getElementById("fieldCount"),de=document.getElementById("upload-area"),pe=document.getElementById("tool-container"),z=document.getElementById("dropZone"),Me=document.getElementById("pdfFileInput"),Ne=document.getElementById("blankPdfBtn");document.getElementById("pdfUploadInput");const Ee=document.getElementById("pageSizeSelector"),oe=document.getElementById("pageSizeSelect"),he=document.getElementById("customDimensionsInput"),qe=document.getElementById("customWidth"),Re=document.getElementById("customHeight"),je=document.getElementById("confirmBlankBtn"),Ve=document.getElementById("pageIndicator"),Le=document.getElementById("prevPageBtn"),Ce=document.getElementById("nextPageBtn"),We=document.getElementById("addPageBtn"),Oe=document.getElementById("resetBtn"),ze=document.getElementById("downloadBtn");document.getElementById("back-to-tools");const J=document.querySelectorAll(".tool-item");J.forEach(e=>{e.addEventListener("dragstart",o=>{if(o instanceof DragEvent&&o.dataTransfer){o.dataTransfer.effectAllowed="copy";const c=e.dataset.type||"text";o.dataTransfer.setData("text/plain",c)}}),e.addEventListener("click",()=>{const o=e.dataset.type||"text";D===o?(D=null,e.classList.remove("ring-2","ring-indigo-400","bg-indigo-600"),x.style.cursor="default"):(D&&J.forEach(c=>c.classList.remove("ring-2","ring-indigo-400","bg-indigo-600")),D=o,e.classList.add("ring-2","ring-indigo-400","bg-indigo-600"),x.style.cursor="crosshair")});let n=0,a=0,s=!1;e.addEventListener("touchstart",o=>{const c=o.touches[0];n=c.clientX,a=c.clientY,s=!1}),e.addEventListener("touchmove",o=>{o.preventDefault();const c=o.touches[0],r=Math.abs(c.clientX-n),i=Math.abs(c.clientY-a);(r>10||i>10)&&(s=!0)}),e.addEventListener("touchend",o=>{if(o.preventDefault(),!s){e.click();return}const c=o.changedTouches[0],r=x.getBoundingClientRect();if(c.clientX>=r.left&&c.clientX<=r.right&&c.clientY>=r.top&&c.clientY<=r.bottom){const i=c.clientX-r.left-75,t=c.clientY-r.top-15,u=e.dataset.type||"text";ue(u,i,t)}})});x.addEventListener("dragover",e=>{e.preventDefault(),e.dataTransfer&&(e.dataTransfer.dropEffect="copy")});x.addEventListener("drop",e=>{e.preventDefault();const n=x.getBoundingClientRect(),a=e.clientX-n.left-75,s=e.clientY-n.top-15,o=e.dataTransfer?.getData("text/plain")||"text";ue(o,a,s)});x.addEventListener("click",e=>{if(D){const n=x.getBoundingClientRect(),a=e.clientX-n.left-75,s=e.clientY-n.top-15;ue(D,a,s),J.forEach(o=>o.classList.remove("ring-2","ring-indigo-400","bg-indigo-600")),D=null,x.style.cursor="default";return}e.target===x&&G()});function ue(e,n,a){H++;const s={id:`field_${H}`,type:e,x:Math.max(0,Math.min(n,666)),y:Math.max(0,Math.min(a,1026)),width:e==="checkbox"||e==="radio"?30:150,height:30,name:`${e.charAt(0).toUpperCase()+e.slice(1)}_${H}`,defaultValue:"",fontSize:12,alignment:"left",textColor:"#000000",required:!1,readOnly:!1,tooltip:"",combCells:0,maxLength:0,options:e==="dropdown"||e==="optionlist"?["Option 1","Option 2","Option 3"]:void 0,checked:e==="radio"||e==="checkbox"?!1:void 0,exportValue:e==="radio"||e==="checkbox"?"Yes":void 0,groupName:e==="radio"?"RadioGroup1":void 0,label:e==="button"?"Button":e==="image"?"Click to Upload Image":void 0,action:e==="button"?"none":void 0,jsScript:e==="button"?'app.alert("Hello World!");':void 0,visibilityAction:e==="button"?"toggle":void 0,dateFormat:e==="date"?"mm/dd/yyyy":void 0,pageIndex:T,multiline:e==="text"?!1:void 0};F.push(s),U(s),ge()}function U(e){const n=document.createElement("div");n.id=e.id,n.className="absolute cursor-move group",n.style.left=e.x+"px",n.style.top=e.y+"px",n.style.width=e.width+"px",n.style.overflow="visible";const a=document.createElement("div");a.className="field-label absolute left-0 w-full text-xs font-semibold pointer-events-none select-none opacity-0 group-hover:opacity-100 transition-opacity",a.style.bottom="100%",a.style.marginBottom="4px",a.style.color="#374151",a.style.fontSize="11px",a.style.lineHeight="1",a.style.whiteSpace="nowrap",a.style.overflow="hidden",a.style.textOverflow="ellipsis",a.textContent=e.name;const s=document.createElement("div");s.className="field-container relative border-2 border-indigo-200 group-hover:border-dashed group-hover:border-indigo-300 bg-indigo-50/30 rounded transition-all",s.style.width="100%",s.style.height=e.height+"px";const o=document.createElement("div");if(o.className="field-content w-full h-full flex items-center justify-center overflow-hidden",e.type==="text")o.className="field-text w-full h-full flex items-center px-2 text-sm overflow-hidden",o.style.fontSize=e.fontSize+"px",o.style.textAlign=e.alignment,o.style.justifyContent=e.alignment==="left"?"flex-start":e.alignment==="right"?"flex-end":"center",o.style.color=e.textColor,o.style.whiteSpace=e.multiline?"pre-wrap":"nowrap",o.style.textOverflow="ellipsis",o.style.alignItems=e.multiline?"flex-start":"center",o.textContent=e.defaultValue,e.combCells>0&&(o.style.backgroundImage=`repeating-linear-gradient(90deg, transparent, transparent calc((100% / ${e.combCells}) - 1px), #e5e7eb calc((100% / ${e.combCells}) - 1px), #e5e7eb calc(100% / ${e.combCells}))`,o.style.fontFamily="monospace",o.style.letterSpacing=`calc(${e.width/e.combCells}px - 1ch)`,o.style.paddingLeft=`calc((${e.width/e.combCells}px - 1ch) / 2)`,o.style.overflow="hidden",o.style.textAlign="left",o.style.justifyContent="flex-start");else if(e.type==="checkbox")o.innerHTML=e.checked?'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-full h-full p-1"><polyline points="20 6 9 17 4 12"></polyline></svg>':"";else if(e.type==="radio")s.classList.add("rounded-full"),o.innerHTML=e.checked?'<div class="w-3/4 h-3/4 bg-black rounded-full"></div>':"";else if(e.type==="dropdown"){o.className="w-full h-full flex items-center px-2 text-sm text-black",o.style.backgroundColor="#e6f0ff";let r="Select...";e.defaultValue&&e.options&&e.options.includes(e.defaultValue)?r=e.defaultValue:e.options&&e.options.length>0&&(r=e.options[0]),o.textContent=r;const i=document.createElement("div");i.className="absolute right-1 top-1/2 -translate-y-1/2",i.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-4 h-4"><path d="m6 9 6 6 6-6"/></svg>',s.appendChild(i)}else if(e.type==="optionlist")if(o.className="w-full h-full flex flex-col text-sm bg-white overflow-hidden border border-gray-300",e.options&&e.options.length>0)e.options.forEach((r,i)=>{const t=document.createElement("div");t.className="px-1 w-full truncate",t.textContent=r,(e.defaultValue?e.defaultValue===r:i===0)?t.className+=" bg-blue-600 text-white":t.className+=" text-black",o.appendChild(t)});else{const r=document.createElement("div");r.className="px-1 w-full text-black italic",r.textContent="Item 1",o.appendChild(r)}else e.type==="button"?(o.className="field-content w-full h-full flex items-center justify-center bg-gray-200 text-sm font-semibold",o.style.color=e.textColor||"#000000",o.textContent=e.label||"Button"):e.type==="signature"?(o.className="w-full h-full flex items-center justify-center bg-gray-50 text-gray-400",o.innerHTML='<div class="flex flex-col items-center"><i data-lucide="pen-tool" class="w-6 h-6 mb-1"></i><span class="text-[10px]">Sign Here</span></div>',setTimeout(()=>window.lucide?.createIcons(),0)):e.type==="date"?(o.className="w-full h-full flex items-center justify-center bg-white text-gray-600 border border-gray-300",o.innerHTML=`<div class="flex items-center gap-2 px-2"><i data-lucide="calendar" class="w-4 h-4"></i><span class="text-sm date-format-text">${e.dateFormat||"mm/dd/yyyy"}</span></div>`,setTimeout(()=>window.lucide?.createIcons(),0)):e.type==="image"&&(o.className="w-full h-full flex items-center justify-center bg-gray-100 text-gray-500 border border-gray-300",o.innerHTML=`<div class="flex flex-col items-center text-center p-1"><i data-lucide="image" class="w-6 h-6 mb-1"></i><span class="text-[10px] leading-tight">${e.label||"Click to Upload Image"}</span></div>`,setTimeout(()=>window.lucide?.createIcons(),0));s.appendChild(o),n.appendChild(a),n.appendChild(s),n.addEventListener("click",r=>{r.stopPropagation(),Q(e)}),n.addEventListener("mousedown",r=>{if(r.target.classList.contains("resize-handle"))return;P=n;const i=x.getBoundingClientRect();Y=r.clientX-i.left-e.x,X=r.clientY-i.top-e.y,Q(e),r.preventDefault()}),n.addEventListener("touchstart",r=>{if(r.target.classList.contains("resize-handle"))return;const i=r.touches[0],t=x.getBoundingClientRect();Y=i.clientX-t.left-e.x,X=i.clientY-t.top-e.y,Q(e)},{passive:!0}),n.addEventListener("touchmove",r=>{r.preventDefault();const i=r.touches[0],t=x.getBoundingClientRect();let u=i.clientX-t.left-Y,p=i.clientY-t.top-X;u=Math.max(0,Math.min(u,816-n.offsetWidth)),p=Math.max(0,Math.min(p,1056-n.offsetHeight)),n.style.left=u+"px",n.style.top=p+"px",e.x=u,e.y=p}),n.addEventListener("touchend",()=>{}),["nw","ne","sw","se","n","s","e","w"].forEach(r=>{const i=document.createElement("div");i.className=`absolute w-2.5 h-2.5 bg-white border border-indigo-600 z-10 cursor-${r}-resize resize-handle hidden`;const t={nw:"top-0 left-0 -translate-x-1/2 -translate-y-1/2",ne:"top-0 right-0 translate-x-1/2 -translate-y-1/2",sw:"bottom-0 left-0 -translate-x-1/2 translate-y-1/2",se:"bottom-0 right-0 translate-x-1/2 translate-y-1/2",n:"top-0 left-1/2 -translate-x-1/2 -translate-y-1/2",s:"bottom-0 left-1/2 -translate-x-1/2 translate-y-1/2",e:"top-1/2 right-0 translate-x-1/2 -translate-y-1/2",w:"top-1/2 left-0 -translate-x-1/2 -translate-y-1/2"};i.className+=` ${t[r]}`,i.dataset.position=r,i.addEventListener("mousedown",u=>{u.stopPropagation(),be(u,e,r)}),i.addEventListener("touchstart",u=>{u.stopPropagation(),u.preventDefault();const p=u.touches[0],v={clientX:p.clientX,clientY:p.clientY,preventDefault:()=>{}};be(v,e,r)}),s.appendChild(i)}),x.appendChild(n)}function be(e,n,a){O=!0,g=n,A=a,ie=e.clientX,le=e.clientY,j=n.width,V=n.height,se=n.x,re=n.y,e.preventDefault()}document.addEventListener("mousemove",e=>{if(P&&!O){const n=x.getBoundingClientRect();let a=e.clientX-n.left-Y,s=e.clientY-n.top-X;a=Math.max(0,Math.min(a,816-P.offsetWidth)),s=Math.max(0,Math.min(s,1056-P.offsetHeight)),P.style.left=a+"px",P.style.top=s+"px";const o=F.find(c=>c.id===P.id);o&&(o.x=a,o.y=s)}else if(O&&g){const n=e.clientX-ie,a=e.clientY-le,s=document.getElementById(g.id);if(A.includes("e")&&(g.width=Math.max(50,j+n)),A.includes("w")){const o=Math.max(50,j-n),c=j-o;g.width=o,g.x=se+c}if(A.includes("s")&&(g.height=Math.max(20,V+a)),A.includes("n")){const o=Math.max(20,V-a),c=V-o;g.height=o,g.y=re+c}if(s){const o=s.querySelector(".field-container");if(s.style.width=g.width+"px",s.style.left=g.x+"px",s.style.top=g.y+"px",o&&(o.style.height=g.height+"px"),g.combCells>0){const c=s.querySelector(".field-text");c&&(c.style.letterSpacing=`calc(${g.width/g.combCells}px - 1ch)`,c.style.paddingLeft=`calc((${g.width/g.combCells}px - 1ch) / 2)`)}}}});document.addEventListener("mouseup",()=>{P=null,O=!1,g=null});document.addEventListener("touchmove",e=>{const n=e.touches[0];if(O&&g){const a=n.clientX-ie,s=n.clientY-le,o=document.getElementById(g.id);if(A.includes("e")&&(g.width=Math.max(50,j+a)),A.includes("w")){const c=Math.max(50,j-a),r=j-c;g.width=c,g.x=se+r}if(A.includes("s")&&(g.height=Math.max(20,V+s)),A.includes("n")){const c=Math.max(20,V-s),r=V-c;g.height=c,g.y=re+r}if(o){const c=o.querySelector(".field-container");if(o.style.width=g.width+"px",o.style.left=g.x+"px",o.style.top=g.y+"px",c&&(c.style.height=g.height+"px"),g.combCells>0){const r=o.querySelector(".field-text");r&&(r.style.letterSpacing=`calc(${g.width/g.combCells}px - 1ch)`,r.style.paddingLeft=`calc((${g.width/g.combCells}px - 1ch) / 2)`)}}}},{passive:!1});document.addEventListener("touchend",()=>{O=!1,g=null});function Q(e){G(),R=e;const n=document.getElementById(e.id);if(n){const a=n.querySelector(".field-container"),s=n.querySelector(".field-label"),o=n.querySelectorAll(".resize-handle");a&&(a.classList.remove("border-indigo-200","group-hover:border-dashed","group-hover:border-indigo-300"),a.classList.add("border-dashed","border-indigo-500","bg-indigo-50")),s&&(s.classList.remove("opacity-0","group-hover:opacity-100"),s.classList.add("opacity-100")),o.forEach(c=>{c.classList.remove("hidden")})}He(e)}function G(){if(R){const e=document.getElementById(R.id);if(e){const n=e.querySelector(".field-container"),a=e.querySelector(".field-label"),s=e.querySelectorAll(".resize-handle");n&&(n.classList.remove("border-dashed","border-indigo-500","bg-indigo-50"),n.classList.add("border-indigo-200","group-hover:border-dashed","group-hover:border-indigo-300")),a&&(a.classList.remove("opacity-100"),a.classList.add("opacity-0","group-hover:opacity-100")),s.forEach(o=>{o.classList.add("hidden")})}R=null}Ue()}function He(e){let n="";e.type==="text"?n=`
        <div>
            <label class="block text-xs font-semibold text-gray-300 mb-1">Value</label>
            <input type="text" id="propValue" value="${e.defaultValue}" ${e.combCells>0?`maxlength="${e.combCells}"`:e.maxLength>0?`maxlength="${e.maxLength}"`:""} class="w-full bg-gray-600 border border-gray-500 text-white rounded px-2 py-1 text-sm focus:ring-indigo-500 focus:border-indigo-500">
        </div>
        <div>
            <label class="block text-xs font-semibold text-gray-300 mb-1">Max Length (0 for unlimited)</label>
            <input type="number" id="propMaxLength" value="${e.maxLength}" min="0" ${e.combCells>0?"disabled":""} class="w-full bg-gray-600 border border-gray-500 text-white rounded px-2 py-1 text-sm focus:ring-indigo-500 focus:border-indigo-500 disabled:opacity-50">
        </div>
        <div>
            <label class="block text-xs font-semibold text-gray-300 mb-1">Divide into boxes (0 to disable)</label>
            <input type="number" id="propComb" value="${e.combCells}" min="0" class="w-full bg-gray-600 border border-gray-500 text-white rounded px-2 py-1 text-sm focus:ring-indigo-500 focus:border-indigo-500">
        </div>
        <div>
            <label class="block text-xs font-semibold text-gray-300 mb-1">Font Size</label>
            <input type="number" id="propFontSize" value="${e.fontSize}" min="8" max="72" class="w-full bg-gray-600 border border-gray-500 text-white rounded px-2 py-1 text-sm focus:ring-indigo-500 focus:border-indigo-500">
        </div>
        <div>
            <label class="block text-xs font-semibold text-gray-300 mb-1">Text Color</label>
            <input type="color" id="propTextColor" value="${e.textColor}" class="w-full border border-gray-500 rounded px-2 py-1 h-10">
        </div>
        <div>
            <label class="block text-xs font-semibold text-gray-300 mb-1">Alignment</label>
            <select id="propAlignment" class="w-full bg-gray-600 border border-gray-500 text-white rounded px-2 py-1 text-sm focus:ring-indigo-500 focus:border-indigo-500">
            <option value="left" ${e.alignment==="left"?"selected":""}>Left</option>
            <option value="center" ${e.alignment==="center"?"selected":""}>Center</option>
            <option value="right" ${e.alignment==="right"?"selected":""}>Right</option>
            </select>
        </div>
        <div class="flex items-center justify-between bg-gray-600 p-2 rounded mt-2">
            <label for="propMultiline" class="text-xs font-semibold text-gray-300">Multi-line</label>
            <button id="propMultilineBtn" class="w-12 h-6 rounded-full transition-colors duration-200 focus:outline-none ${e.multiline?"bg-indigo-600":"bg-gray-500"} relative">
                <span class="absolute top-1 left-1 bg-white w-4 h-4 rounded-full transition-transform duration-200 ${e.multiline?"translate-x-6":"translate-x-0"}"></span>
            </button>
        </div>
        `:e.type==="checkbox"?n=`
        <div class="flex items-center justify-between bg-gray-600 p-2 rounded">
            <label for="propChecked" class="text-xs font-semibold text-gray-300">Checked State</label>
            <button id="propCheckedBtn" class="w-12 h-6 rounded-full transition-colors duration-200 focus:outline-none ${e.checked?"bg-indigo-600":"bg-gray-500"} relative">
                <span class="absolute top-1 left-1 bg-white w-4 h-4 rounded-full transition-transform duration-200 ${e.checked?"translate-x-6":"translate-x-0"}"></span>
            </button>
        </div>
        `:e.type==="radio"?n=`
        <div>
            <label class="block text-xs font-semibold text-gray-300 mb-1">Group Name (Must be same for group)</label>
            <input type="text" id="propGroupName" value="${e.groupName}" class="w-full bg-gray-600 border border-gray-500 text-white rounded px-2 py-1 text-sm focus:ring-indigo-500 focus:border-indigo-500">
        </div>
        <div>
            <label class="block text-xs font-semibold text-gray-300 mb-1">Export Value</label>
            <input type="text" id="propExportValue" value="${e.exportValue}" class="w-full bg-gray-600 border border-gray-500 text-white rounded px-2 py-1 text-sm focus:ring-indigo-500 focus:border-indigo-500">
        </div>
        <div class="flex items-center justify-between bg-gray-600 p-2 rounded mt-2">
            <label for="propChecked" class="text-xs font-semibold text-gray-300">Checked State</label>
            <button id="propCheckedBtn" class="w-12 h-6 rounded-full transition-colors duration-200 focus:outline-none ${e.checked?"bg-indigo-600":"bg-gray-500"} relative">
                <span class="absolute top-1 left-1 bg-white w-4 h-4 rounded-full transition-transform duration-200 ${e.checked?"translate-x-6":"translate-x-0"}"></span>
            </button>
        </div>
        `:e.type==="dropdown"||e.type==="optionlist"?n=`
        <div>
            <label class="block text-xs font-semibold text-gray-300 mb-1">Options (One per line or comma separated)</label>
            <textarea id="propOptions" class="w-full bg-gray-600 border border-gray-500 text-white rounded px-2 py-1 text-sm focus:ring-indigo-500 focus:border-indigo-500 h-24">${e.options?.join(`
`)}</textarea>
        </div>
        <div>
            <label class="block text-xs font-semibold text-gray-300 mb-1">Selected Option</label>
            <select id="propSelectedOption" class="w-full bg-gray-600 border border-gray-500 text-white rounded px-2 py-1 text-sm focus:ring-indigo-500 focus:border-indigo-500">
                <option value="">None</option>
                ${e.options?.map(i=>`<option value="${i}" ${e.defaultValue===i?"selected":""}>${i}</option>`).join("")}
            </select>
        </div>
        <div class="text-xs text-gray-400 italic mt-2">
            To actually fill or change the options, use our PDF Form Filler tool.
        </div>
        `:e.type==="button"?n=`
        <div>
            <label class="block text-xs font-semibold text-gray-300 mb-1">Label</label>
            <input type="text" id="propLabel" value="${e.label}" class="w-full bg-gray-600 border border-gray-500 text-white rounded px-2 py-1 text-sm focus:ring-indigo-500 focus:border-indigo-500">
        </div>
        <div>
            <label class="block text-xs font-semibold text-gray-300 mb-1">Action</label>
            <select id="propAction" class="w-full bg-gray-600 border border-gray-500 text-white rounded px-2 py-1 text-sm focus:ring-indigo-500 focus:border-indigo-500">
                <option value="none" ${e.action==="none"?"selected":""}>None</option>
                <option value="reset" ${e.action==="reset"?"selected":""}>Reset Form</option>
                <option value="print" ${e.action==="print"?"selected":""}>Print Form</option>
                <option value="url" ${e.action==="url"?"selected":""}>Open URL</option>
                <option value="js" ${e.action==="js"?"selected":""}>Run Javascript</option>
                <option value="showHide" ${e.action==="showHide"?"selected":""}>Show/Hide Field</option>
            </select>
        </div>
        <div id="propUrlContainer" class="${e.action==="url"?"":"hidden"}">
            <label class="block text-xs font-semibold text-gray-300 mb-1">URL</label>
            <input type="text" id="propActionUrl" value="${e.actionUrl||""}" placeholder="https://example.com" class="w-full bg-gray-600 border border-gray-500 text-white rounded px-2 py-1 text-sm focus:ring-indigo-500 focus:border-indigo-500">
        </div>
        <div id="propJsContainer" class="${e.action==="js"?"":"hidden"}">
            <label class="block text-xs font-semibold text-gray-300 mb-1">Javascript Code</label>
            <textarea id="propJsScript" class="w-full bg-gray-600 border border-gray-500 text-white rounded px-2 py-1 text-sm focus:ring-indigo-500 focus:border-indigo-500 h-24 font-mono">${e.jsScript||""}</textarea>
        </div>
        <div id="propShowHideContainer" class="${e.action==="showHide"?"":"hidden"}">
            <div class="mb-2">
                <label class="block text-xs font-semibold text-gray-300 mb-1">Target Field</label>
                <select id="propTargetField" class="w-full bg-gray-600 border border-gray-500 text-white rounded px-2 py-1 text-sm focus:ring-indigo-500 focus:border-indigo-500">
                    <option value="">Select a field...</option>
                    ${F.filter(i=>i.id!==e.id).map(i=>`<option value="${i.name}" ${e.targetFieldName===i.name?"selected":""}>${i.name} (${i.type})</option>`).join("")}
                </select>
            </div>
            <div>
                <label class="block text-xs font-semibold text-gray-300 mb-1">Visibility</label>
                <select id="propVisibilityAction" class="w-full bg-gray-600 border border-gray-500 text-white rounded px-2 py-1 text-sm focus:ring-indigo-500 focus:border-indigo-500">
                    <option value="show" ${e.visibilityAction==="show"?"selected":""}>Show</option>
                    <option value="hide" ${e.visibilityAction==="hide"?"selected":""}>Hide</option>
                    <option value="toggle" ${e.visibilityAction==="toggle"?"selected":""}>Toggle</option>
                </select>
            </div>
        </div>
        `:e.type==="signature"?n=`
        <div class="text-xs text-gray-400 italic mb-2">
            Signature fields are AcroForm signature fields and would only be visible in an advanced PDF viewer.
        </div>
        `:e.type==="date"?n=`
        <div>
            <label class="block text-xs font-semibold text-gray-300 mb-1">Date Format</label>
            <select id="propDateFormat" class="w-full bg-gray-600 border border-gray-500 text-white rounded px-2 py-1 text-sm focus:ring-indigo-500 focus:border-indigo-500">
                ${["mm/dd/yyyy","dd/mm/yyyy","mm/yy","dd/mm/yy","yyyy/mm/dd","mmm d, yyyy","d-mmm-yy","yy-mm-dd"].map(t=>`<option value="${t}" ${e.dateFormat===t?"selected":""}>${t}</option>`).join("")}
            </select>
        </div>
        <div class="text-xs text-gray-400 italic mt-2">
            The selected format will be enforced when the user types or picks a date.
        </div>
        <div class="bg-blue-900/30 border border-blue-700/50 rounded p-2 mt-2">
            <p class="text-xs text-blue-200 flex gap-2">
                <i data-lucide="info" class="w-4 h-4 flex-shrink-0"></i>
                <span><strong>Browser Note:</strong> Firefox and Chrome may show their native date picker format during selection. The correct format will apply when you finish entering the date. This is normal browser behavior and not an issue.</span>
            </p>
        </div>
        `:e.type==="image"&&(n=`
        <div>
            <label class="block text-xs font-semibold text-gray-300 mb-1">Label / Prompt</label>
            <input type="text" id="propLabel" value="${e.label}" class="w-full bg-gray-600 border border-gray-500 text-white rounded px-2 py-1 text-sm focus:ring-indigo-500 focus:border-indigo-500">
        </div>
        <div class="text-xs text-gray-400 italic mt-2">
            Clicking this field in the PDF will open a file picker to upload an image.
        </div>
        `),ce.innerHTML=`
    <div class="space-y-3">
      <div>
        <label class="block text-xs font-semibold text-gray-300 mb-1">Field Name</label>
        <input type="text" id="propName" value="${e.name}" class="w-full bg-gray-600 border border-gray-500 text-white rounded px-2 py-1 text-sm focus:ring-indigo-500 focus:border-indigo-500">
      </div>
      ${n}
      <div>
        <label class="block text-xs font-semibold text-gray-300 mb-1">Tooltip / Help Text</label>
        <input type="text" id="propTooltip" value="${e.tooltip}" placeholder="Description for screen readers" class="w-full bg-gray-600 border border-gray-500 text-white rounded px-2 py-1 text-sm focus:ring-indigo-500 focus:border-indigo-500">
      </div>
      <div class="flex items-center">
        <input type="checkbox" id="propRequired" ${e.required?"checked":""} class="mr-2">
        <label for="propRequired" class="text-xs font-semibold text-gray-300">Required</label>
      </div>
      <div class="flex items-center">
        <input type="checkbox" id="propReadOnly" ${e.readOnly?"checked":""} class="mr-2">
        <label for="propReadOnly" class="text-xs font-semibold text-gray-300">Read Only</label>
      </div>
      <button id="deleteBtn" class="w-full bg-red-600 text-white py-2 rounded hover:bg-red-700 transition text-sm font-semibold">
        Delete Field
      </button>
    </div>
  `;const a=document.getElementById("propName"),s=document.getElementById("propTooltip"),o=document.getElementById("propRequired"),c=document.getElementById("propReadOnly"),r=document.getElementById("deleteBtn");if(a.addEventListener("change",i=>{const t=i.target.value.trim();if(!t){W("Invalid Name","Field name cannot be empty.","warning"),i.target.value=e.name;return}if(F.some(v=>v.id!==e.id&&v.name===t)){W("Duplicate Name",`A field with the name "${t}" already exists. Please choose a unique name.`,"error"),i.target.value=e.name;return}e.name=t;const p=document.getElementById(e.id);if(p){const v=p.querySelector(".field-label");v&&(v.textContent=e.name)}}),s.addEventListener("input",i=>{e.tooltip=i.target.value}),o.addEventListener("change",i=>{e.required=i.target.checked}),c.addEventListener("change",i=>{e.readOnly=i.target.checked}),r.addEventListener("click",()=>{ke(e)}),e.type==="text"){const i=document.getElementById("propValue"),t=document.getElementById("propMaxLength"),u=document.getElementById("propComb"),p=document.getElementById("propFontSize"),v=document.getElementById("propTextColor"),S=document.getElementById("propAlignment");i.addEventListener("input",h=>{e.defaultValue=h.target.value;const m=document.getElementById(e.id);if(m){const d=m.querySelector(".field-text");d&&(d.textContent=e.defaultValue)}}),t.addEventListener("input",h=>{const m=parseInt(h.target.value);if(e.maxLength=isNaN(m)?0:Math.max(0,m),e.maxLength>0){if(i.maxLength=e.maxLength,e.defaultValue.length>e.maxLength){e.defaultValue=e.defaultValue.substring(0,e.maxLength),i.value=e.defaultValue;const d=document.getElementById(e.id);if(d){const b=d.querySelector(".field-text");b&&(b.textContent=e.defaultValue)}}}else i.removeAttribute("maxLength")}),u.addEventListener("input",h=>{const m=parseInt(h.target.value);e.combCells=isNaN(m)?0:Math.max(0,m),e.combCells>0?(i.maxLength=e.combCells,t.value=e.combCells.toString(),t.disabled=!0,e.maxLength=e.combCells,e.defaultValue.length>e.combCells&&(e.defaultValue=e.defaultValue.substring(0,e.combCells),i.value=e.defaultValue)):(t.disabled=!1,i.removeAttribute("maxLength"),e.maxLength>0&&(i.maxLength=e.maxLength));const d=document.getElementById(e.id);if(d){const b=d.querySelector(".field-text");b&&(b.textContent=e.defaultValue,e.combCells>0?(b.style.backgroundImage=`repeating-linear-gradient(90deg, transparent, transparent calc((100% / ${e.combCells}) - 1px), #e5e7eb calc((100% / ${e.combCells}) - 1px), #e5e7eb calc(100% / ${e.combCells}))`,b.style.fontFamily="monospace",b.style.letterSpacing=`calc(${e.width/e.combCells}px - 1ch)`,b.style.paddingLeft=`calc((${e.width/e.combCells}px - 1ch) / 2)`,b.style.overflow="hidden",b.style.textAlign="left",b.style.justifyContent="flex-start"):(b.style.backgroundImage="none",b.style.fontFamily="inherit",b.style.letterSpacing="normal",b.style.textAlign=e.alignment,b.style.justifyContent=e.alignment==="left"?"flex-start":e.alignment==="right"?"flex-end":"center"))}}),p.addEventListener("input",h=>{e.fontSize=parseInt(h.target.value);const m=document.getElementById(e.id);if(m){const d=m.querySelector(".field-text");d&&(d.style.fontSize=e.fontSize+"px")}}),v.addEventListener("input",h=>{e.textColor=h.target.value;const m=document.getElementById(e.id);if(m){const d=m.querySelector(".field-text");d&&(d.style.color=e.textColor)}}),S.addEventListener("change",h=>{e.alignment=h.target.value;const m=document.getElementById(e.id);if(m){const d=m.querySelector(".field-text");d&&(d.style.textAlign=e.alignment,d.style.justifyContent=e.alignment==="left"?"flex-start":e.alignment==="right"?"flex-end":"center")}});const E=document.getElementById("propMultilineBtn");E&&E.addEventListener("click",()=>{e.multiline=!e.multiline;const h=E.querySelector("span");e.multiline?(E.classList.remove("bg-gray-500"),E.classList.add("bg-indigo-600"),h?.classList.remove("translate-x-0"),h?.classList.add("translate-x-6")):(E.classList.remove("bg-indigo-600"),E.classList.add("bg-gray-500"),h?.classList.remove("translate-x-6"),h?.classList.add("translate-x-0"));const m=document.getElementById(e.id);if(m){const d=m.querySelector(".field-text");d&&(e.multiline?(d.style.whiteSpace="pre-wrap",d.style.alignItems="flex-start",d.style.overflow="hidden"):(d.style.whiteSpace="nowrap",d.style.alignItems="center",d.style.overflow="hidden"))}})}else if(e.type==="checkbox"||e.type==="radio"){const i=document.getElementById("propCheckedBtn");if(i.addEventListener("click",()=>{e.checked=!e.checked;const t=i.querySelector("span");e.checked?(i.classList.remove("bg-gray-500"),i.classList.add("bg-indigo-600"),t?.classList.remove("translate-x-0"),t?.classList.add("translate-x-6")):(i.classList.remove("bg-indigo-600"),i.classList.add("bg-gray-500"),t?.classList.remove("translate-x-6"),t?.classList.add("translate-x-0"));const u=document.getElementById(e.id);if(u){const p=u.querySelector(".field-content");p&&(e.type==="checkbox"?p.innerHTML=e.checked?'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-full h-full p-1"><polyline points="20 6 9 17 4 12"></polyline></svg>':"":p.innerHTML=e.checked?'<div class="w-3/4 h-3/4 bg-black rounded-full"></div>':"")}}),e.type==="radio"){const t=document.getElementById("propGroupName"),u=document.getElementById("propExportValue");t.addEventListener("input",p=>{e.groupName=p.target.value}),u.addEventListener("input",p=>{e.exportValue=p.target.value})}}else if(e.type==="dropdown"||e.type==="optionlist")document.getElementById("propOptions").addEventListener("input",u=>{const p=u.target.value;e.options=p.split(/[\n,]/).map(S=>S.trim()).filter(S=>S.length>0);const v=document.getElementById("propSelectedOption");if(v){const S=e.defaultValue;v.innerHTML='<option value="">None</option>'+e.options?.map(E=>`<option value="${E}" ${S===E?"selected":""}>${E}</option>`).join(""),S&&e.options&&!e.options.includes(S)&&(e.defaultValue="",v.value="")}U(e)}),document.getElementById("propSelectedOption").addEventListener("change",u=>{e.defaultValue=u.target.value,U(e)});else if(e.type==="button"){document.getElementById("propLabel").addEventListener("input",d=>{e.label=d.target.value;const b=document.getElementById(e.id);if(b){const l=b.querySelector(".field-content");l&&(l.textContent=e.label||"Button")}});const t=document.getElementById("propAction"),u=document.getElementById("propUrlContainer"),p=document.getElementById("propJsContainer"),v=document.getElementById("propShowHideContainer");t.addEventListener("change",d=>{e.action=d.target.value,u.classList.add("hidden"),p.classList.add("hidden"),v.classList.add("hidden"),e.action==="url"?u.classList.remove("hidden"):e.action==="js"?p.classList.remove("hidden"):e.action==="showHide"&&v.classList.remove("hidden")}),document.getElementById("propActionUrl").addEventListener("input",d=>{e.actionUrl=d.target.value});const E=document.getElementById("propJsScript");E&&E.addEventListener("input",d=>{e.jsScript=d.target.value});const h=document.getElementById("propTargetField");h&&h.addEventListener("change",d=>{e.targetFieldName=d.target.value});const m=document.getElementById("propVisibilityAction");m&&m.addEventListener("change",d=>{e.visibilityAction=d.target.value})}else if(e.type!=="signature")if(e.type==="date"){const i=document.getElementById("propDateFormat");i&&i.addEventListener("change",t=>{e.dateFormat=t.target.value;const u=document.getElementById(e.id);if(u){const p=u.querySelector(".date-format-text");p&&(p.textContent=e.dateFormat)}setTimeout(()=>window.lucide?.createIcons(),0)})}else e.type==="image"&&document.getElementById("propLabel").addEventListener("input",t=>{e.label=t.target.value,U(e)})}function Ue(){ce.innerHTML='<p class="text-gray-500 text-sm">Select a field to edit properties</p>'}function ke(e){const n=document.getElementById(e.id);n&&n.remove(),F=F.filter(a=>a.id!==e.id),G(),ge()}document.addEventListener("keydown",e=>{e.key==="Delete"&&R?ke(R):e.key==="Escape"&&D&&(J.forEach(n=>n.classList.remove("ring-2","ring-indigo-400","bg-indigo-600")),D=null,x.style.cursor="default")});function ge(){Pe.textContent=F.length.toString()}ze.addEventListener("click",async()=>{const e=new Map,n=[];if(F.forEach(a=>{const s=e.get(a.name)||0;e.set(a.name,s+1)}),e.forEach((a,s)=>{a>1&&n.push(s)}),n.length>0){const a=n.map(s=>`"${s}"`).join(", ");W("Duplicate Field Names",`The following field names are used more than once: ${a}. Please rename these fields to use unique names before downloading.`,"error");return}if(F.length===0){alert("Please add at least one field before downloading.");return}if(B.length===0){alert("No pages found. Please create a blank PDF or upload one.");return}try{let a;if(N)a=N;else{a=await we.create();for(const t of B)a.addPage([t.width,t.height])}const s=a.getForm(),o=await a.embedFont(Te.Helvetica);a.setTitle("Fillable Form"),a.setAuthor("BentoPDF"),a.setLanguage("en-US");const c=new Map;for(const t of F){if(!B[t.pageIndex])continue;const p=a.getPage(t.pageIndex),{height:v}=p.getSize(),S=1/te,E=1/te,h=t.x*S,m=v-t.y*E-t.height*E,d=t.width*S,b=t.height*E;if(t.type==="text"){const l=s.createTextField(t.name),f=_(t.textColor);l.addToPage(p,{x:h,y:m,width:d,height:b,borderWidth:1,borderColor:k(0,0,0),backgroundColor:k(1,1,1),textColor:k(f.r,f.g,f.b)}),l.setText(t.defaultValue),l.setFontSize(t.fontSize),t.alignment==="center"?l.setAlignment(Z.Center):t.alignment==="right"?l.setAlignment(Z.Right):l.setAlignment(Z.Left),t.combCells>0?(l.setMaxLength(t.combCells),l.enableCombing()):t.maxLength>0&&l.setMaxLength(t.maxLength),t.multiline?l.enableMultiline():l.disableMultiline(),t.required&&l.enableRequired(),t.readOnly&&l.enableReadOnly(),t.tooltip&&l.acroField.getWidgets().forEach(w=>{w.dict.set(y.of("TU"),I.of(t.tooltip))})}else if(t.type==="checkbox"){const l=s.createCheckBox(t.name);l.addToPage(p,{x:h,y:m,width:d,height:b,borderWidth:1,borderColor:k(0,0,0),backgroundColor:k(1,1,1)}),t.checked&&l.check(),t.required&&l.enableRequired(),t.readOnly&&l.enableReadOnly(),t.tooltip&&l.acroField.getWidgets().forEach(f=>{f.dict.set(y.of("TU"),I.of(t.tooltip))})}else if(t.type==="radio"){const l=t.groupName||"RadioGroup1";let f;c.has(l)?f=c.get(l):(f=s.createRadioGroup(l),c.set(l,f)),f.addOptionToPage(t.exportValue||"Yes",p,{x:h,y:m,width:d,height:b,borderWidth:1,borderColor:k(0,0,0),backgroundColor:k(1,1,1)}),t.checked&&f.select(t.exportValue||"Yes"),t.required&&f.enableRequired(),t.readOnly&&f.enableReadOnly(),t.tooltip&&f.acroField.getWidgets().forEach(w=>{w.dict.set(y.of("TU"),I.of(t.tooltip))})}else if(t.type==="dropdown"){const l=s.createDropdown(t.name);l.addToPage(p,{x:h,y:m,width:d,height:b,borderWidth:1,borderColor:k(0,0,0),backgroundColor:k(1,1,1)}),t.options&&l.setOptions(t.options),t.defaultValue&&t.options?.includes(t.defaultValue)?l.select(t.defaultValue):t.options&&t.options.length>0&&l.select(t.options[0]);const f=_(t.textColor);l.acroField.setFontSize(t.fontSize),l.acroField.setDefaultAppearance(`0 0 0 rg /Helv ${t.fontSize} Tf`),t.required&&l.enableRequired(),t.readOnly&&l.enableReadOnly(),t.tooltip&&l.acroField.getWidgets().forEach(w=>{w.dict.set(y.of("TU"),I.of(t.tooltip))})}else if(t.type==="optionlist"){const l=s.createOptionList(t.name);l.addToPage(p,{x:h,y:m,width:d,height:b,borderWidth:1,borderColor:k(0,0,0),backgroundColor:k(1,1,1)}),t.options&&l.setOptions(t.options),t.defaultValue&&t.options?.includes(t.defaultValue)?l.select(t.defaultValue):t.options&&t.options.length>0&&l.select(t.options[0]);const f=_(t.textColor);l.acroField.setFontSize(t.fontSize),l.acroField.setDefaultAppearance(`0 0 0 rg /Helv ${t.fontSize} Tf`),t.required&&l.enableRequired(),t.readOnly&&l.enableReadOnly(),t.tooltip&&l.acroField.getWidgets().forEach(w=>{w.dict.set(y.of("TU"),I.of(t.tooltip))})}else if(t.type==="button"){const l=s.createButton(t.name);l.addToPage(t.label||"Button",p,{x:h,y:m,width:d,height:b,borderWidth:1,borderColor:k(0,0,0),backgroundColor:k(.8,.8,.8)}),t.action&&t.action!=="none"&&l.acroField.getWidgets().forEach(w=>{let L;if(t.action==="reset")L=a.context.obj({Type:"Action",S:"ResetForm"});else if(t.action==="print")L=a.context.obj({Type:"Action",S:"JavaScript",JS:"print();"});else if(t.action==="url"&&t.actionUrl){let C=t.actionUrl.trim();!C.startsWith("http://")&&!C.startsWith("https://")&&(C="https://"+C);try{C=encodeURI(C)}catch($){console.warn("Failed to encode URL:",$)}L=a.context.obj({Type:"Action",S:"URI",URI:I.of(C)})}else if(t.action==="js"&&t.jsScript)L=a.context.obj({Type:"Action",S:"JavaScript",JS:t.jsScript});else if(t.action==="showHide"&&t.targetFieldName){const C=t.targetFieldName;let $="";t.visibilityAction==="show"?$=`var f = this.getField("${C}"); if(f) f.display = display.visible;`:t.visibilityAction==="hide"?$=`var f = this.getField("${C}"); if(f) f.display = display.hidden;`:$=`var f = this.getField("${C}"); if(f) f.display = (f.display === display.visible) ? display.hidden : display.visible;`,L=a.context.obj({Type:"Action",S:"JavaScript",JS:$})}L&&w.dict.set(y.of("A"),L)}),t.tooltip&&l.acroField.getWidgets().forEach(f=>{f.dict.set(y.of("TU"),I.of(t.tooltip))})}else if(t.type==="date"){const l=s.createTextField(t.name);l.addToPage(p,{x:h,y:m,width:d,height:b,borderWidth:1,borderColor:k(0,0,0),backgroundColor:k(1,1,1)});const f=t.dateFormat||"mm/dd/yyyy",w=a.context.obj({Type:"Action",S:"JavaScript",JS:I.of(`AFDate_FormatEx("${f}");`)}),L=a.context.obj({Type:"Action",S:"JavaScript",JS:I.of(`AFDate_KeystrokeEx("${f}");`)}),C=a.context.obj({F:w,K:L});l.acroField.dict.set(y.of("AA"),C),t.required&&l.enableRequired(),t.readOnly&&l.enableReadOnly(),t.tooltip&&l.acroField.getWidgets().forEach($=>{$.dict.set(y.of("TU"),I.of(t.tooltip))})}else if(t.type==="image"){const l=s.createButton(t.name);l.addToPage(t.label||"Click to Upload Image",p,{x:h,y:m,width:d,height:b,borderWidth:1,borderColor:k(0,0,0),backgroundColor:k(.9,.9,.9)}),l.acroField.getWidgets().forEach(w=>{const L=a.context.obj({Type:"Action",S:"JavaScript",JS:"event.target.buttonImportIcon();"});w.dict.set(y.of("A"),L);const C=a.context.obj({TP:1,BG:[.9,.9,.9],BC:[0,0,0],IF:{SW:y.of("A"),S:y.of("A"),FB:!0}});w.dict.set(y.of("MK"),C)}),t.tooltip&&l.acroField.getWidgets().forEach(w=>{w.dict.set(y.of("TU"),I.of(t.tooltip))})}else if(t.type==="signature"){const l=a.context,f=l.obj({FT:y.of("Sig"),T:I.of(t.name),Kids:[]}),w=l.register(f),L=l.obj({Type:y.of("Annot"),Subtype:y.of("Widget"),Rect:[h,m,h+d,m+b],F:4,P:p.ref,Parent:w}),C=l.obj({W:1,S:y.of("S")});L.set(y.of("BS"),C),L.set(y.of("BC"),l.obj([0,0,0])),L.set(y.of("BG"),l.obj([.95,.95,.95]));const $=l.register(L);f.get(y.of("Kids")).push($),p.node.addAnnot($),s.acroForm.addField(w),t.tooltip&&L.set(y.of("TU"),I.of(t.tooltip))}}s.updateFieldAppearances(o);const r=await a.save(),i=new Blob([new Uint8Array(r)],{type:"application/pdf"});$e(i,"fillable-form.pdf")}catch(a){console.error("Error generating PDF:",a);const s=a.message;if(s.includes("A field already exists with the specified name")){const o=s.match(/A field already exists with the specified name: "(.+?)"/),c=o?o[1]:"unknown";W("Duplicate Field Name",`A field named "${c}" already exists. Please rename this field to use a unique name before downloading.`,"error")}else W("Error","Error generating PDF: "+s,"error")}});const Ye=document.querySelectorAll('[id^="back-to-tools"]');Ye.forEach(e=>{e.addEventListener("click",()=>{window.location.href="/"})});function Xe(e){let n;switch(e){case"letter":n=M.Letter;break;case"a4":n=M.A4;break;case"a5":n=M.A5;break;case"legal":n=M.Legal;break;case"tabloid":n=M.Tabloid;break;case"a3":n=M.A3;break;case"custom":const a=parseInt(qe.value)||612,s=parseInt(Re.value)||792;return{width:a,height:s};default:n=M.Letter}return{width:n[0],height:n[1]}}function fe(){F=[],B=[],T=0,N=null,R=null,x.innerHTML="",ce.innerHTML='<p class="text-gray-500 text-sm">Select a field to edit properties</p>',ge(),de.classList.remove("hidden"),pe.classList.add("hidden"),Ee.classList.add("hidden"),setTimeout(()=>ne({icons:ae}),100)}function Se(){B.push({index:B.length,width:ee.width,height:ee.height}),me()}function K(e){e<0||e>=B.length||(T=e,Be(),me(),G())}function Be(){const e=B[T];if(!e)return;let n=1.333;te=n;const a=e.width*n,s=e.height*n;if(x.style.width=`${a}px`,x.style.height=`${s}px`,x.innerHTML="",e.pdfPageData){const o=document.createElement("img");o.src=e.pdfPageData,o.style.position="absolute",o.style.top="0",o.style.left="0",o.style.width="100%",o.style.height="100%",o.style.pointerEvents="none",o.style.opacity="0.8",x.appendChild(o)}F.filter(o=>o.pageIndex===T).forEach(o=>{U(o)})}function me(){Ve.textContent=`Page ${T+1} of ${B.length}`,Le.disabled=T===0,Ce.disabled=T===B.length-1}z.addEventListener("dragover",e=>{e.preventDefault(),z.classList.add("border-indigo-500","bg-gray-600")});z.addEventListener("dragleave",()=>{z.classList.remove("border-indigo-500","bg-gray-600")});z.addEventListener("drop",e=>{e.preventDefault(),z.classList.remove("border-indigo-500","bg-gray-600");const n=e.dataTransfer?.files;n&&n.length>0&&n[0].type==="application/pdf"&&Ie(n[0])});Me.addEventListener("change",async e=>{const n=e.target.files?.[0];n&&Ie(n)});Ne.addEventListener("click",()=>{Ee.classList.remove("hidden")});oe.addEventListener("change",()=>{oe.value==="custom"?he.classList.remove("hidden"):he.classList.add("hidden")});je.addEventListener("click",()=>{const e=oe.value;ee=Xe(e),Se(),K(0),de.classList.add("hidden"),pe.classList.remove("hidden"),setTimeout(()=>ne({icons:ae}),100)});async function Ie(e){try{const n=await e.arrayBuffer();N=await we.load(n);try{N.getForm().getFields().forEach(r=>{const t=r.getName().match(/([a-zA-Z]+)_(\d+)/);if(t){const u=parseInt(t[2]);!isNaN(u)&&u>=H&&(H=u)}})}catch{}const a=await Ae({data:n}).promise,s=N.getPageCount();B=[];for(let o=0;o<s;o++){const c=N.getPage(o),{width:r,height:i}=c.getSize(),t=await a.getPage(o+1),u=t.getViewport({scale:1.333}),p=document.createElement("canvas");p.width=u.width,p.height=u.height;const v=p.getContext("2d");await t.render({canvasContext:v,viewport:u,canvas:p}).promise;const S=p.toDataURL("image/png");B.push({index:o,width:r,height:i,pdfPageData:S})}T=0,Be(),me(),de.classList.add("hidden"),pe.classList.remove("hidden"),setTimeout(()=>ne({icons:ae}),100)}catch(n){console.error("Error loading PDF:",n),W("Error","Error loading PDF file. Please try again with a valid PDF.","error")}}Le.addEventListener("click",()=>{T>0&&K(T-1)});Ce.addEventListener("click",()=>{T<B.length-1&&K(T+1)});We.addEventListener("click",()=>{Se(),K(B.length-1)});Oe.addEventListener("click",()=>{F.length>0||B.length>0?confirm("Are you sure you want to reset? All your work will be lost.")&&fe():fe()});const q=document.getElementById("errorModal"),ye=document.getElementById("errorModalTitle"),xe=document.getElementById("errorModalMessage"),ve=document.getElementById("errorModalClose");function W(e,n,a="error"){!q||!ye||!xe||(ye.textContent=e,xe.textContent=n,q.classList.remove("hidden"))}ve&&ve.addEventListener("click",()=>{q?.classList.add("hidden")});q&&q.addEventListener("click",e=>{e.target===q&&q.classList.add("hidden")});De();
