import{c as L,i as B}from"./lucide-iiCyoXQ9.js";import{G as ae,m as Z,P as A,g as K,n as oe,e as re,o as ie,J as se,p as V,k as Q}from"./shortcuts-CaOq6dM1.js";import{i as ce}from"./shortcuts-init-cT1Qr9ko.js";ae.workerSrc=new URL("/assets/pdf.worker.min-qwK7q_zL.mjs",import.meta.url).toString();function N(){return Math.random().toString(36).substr(2,9)+Date.now().toString(36)}let c=[],d=new Set,x=[],b=new Set,y=!1,E=!1,k=null;const le=new Map,R=[],q=[];function m(){const t={allPages:c.map(n=>({...n,canvas:n.canvas})),selectedPages:Array.from(d),splitMarkers:Array.from(b)};R.push(t),q.length=0}function O(t){c=t.allPages.map(n=>({...n,canvas:n.canvas})),d=new Set(t.selectedPages),b=new Set(t.splitMarkers),P()}function v(t,n,e="info"){const a=document.getElementById("modal"),o=document.getElementById("modal-title"),r=document.getElementById("modal-message"),i=document.getElementById("modal-icon");if(!a||!o||!r||!i)return;o.textContent=t,r.textContent=n;const s={info:"info",error:"alert-circle",success:"check-circle"},l={info:"text-blue-400",error:"text-red-400",success:"text-green-400"};i.innerHTML=`<i data-lucide="${s[e]}" class="w-12 h-12 ${l[e]}"></i>`,a.classList.remove("hidden"),L({icons:B})}function _(){const t=document.getElementById("modal");t&&t.classList.add("hidden")}function U(t,n){const e=document.getElementById("loading-overlay"),a=document.getElementById("loading-progress"),o=document.getElementById("loading-text");if(!e||!a||!o)return;e.classList.remove("hidden");const r=Math.round(t/n*100);a.style.width=`${r}%`,o.textContent="Rendering pages..."}async function G(t,n){const e=document.getElementById(t);if(!e)return;const a=e.innerHTML,o=e.style.pointerEvents;try{e.disabled=!0,e.style.pointerEvents="none",e.innerHTML='<svg class="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>',await n()}finally{e.disabled=!1,e.style.pointerEvents=o,e.innerHTML=a}}function X(){const t=document.getElementById("loading-overlay");t&&t.classList.add("hidden")}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{console.log("PDF Multi Tool: DOMContentLoaded"),W()}):(console.log("PDF Multi Tool: DOMContentLoaded already fired, initializing immediately"),W());function W(){console.log("PDF Multi Tool: Initializing..."),L({icons:B}),ce(),document.getElementById("close-tool-btn")?.addEventListener("click",()=>{window.location.href="/"}),document.getElementById("upload-pdfs-btn")?.addEventListener("click",()=>{if(console.log("Upload button clicked, isRendering:",y),y){v("Please Wait","Pages are still being rendered. Please wait...","info");return}document.getElementById("pdf-file-input")?.click()}),document.getElementById("pdf-file-input")?.addEventListener("change",de),document.getElementById("insert-pdf-input")?.addEventListener("change",fe),document.getElementById("bulk-rotate-left-btn")?.addEventListener("click",()=>{y||(m(),J(-90))}),document.getElementById("bulk-rotate-btn")?.addEventListener("click",()=>{y||(m(),J(90))}),document.getElementById("bulk-delete-btn")?.addEventListener("click",()=>{y||(m(),me())}),document.getElementById("bulk-duplicate-btn")?.addEventListener("click",()=>{y||(m(),ye())}),document.getElementById("bulk-split-btn")?.addEventListener("click",()=>{y||(m(),he())}),document.getElementById("bulk-download-btn")?.addEventListener("click",()=>{if(!y){if(d.size===0){v("No Pages Selected","Please select at least one page to download.","info");return}G("bulk-download-btn",async()=>{await ne(Array.from(d).sort((n,e)=>n-e),"selected-pages.pdf")})}}),document.getElementById("select-all-btn")?.addEventListener("click",()=>{y||(m(),ge())}),document.getElementById("deselect-all-btn")?.addEventListener("click",()=>{y||(m(),ue())}),document.getElementById("export-pdf-btn")?.addEventListener("click",()=>{if(!y){if(c.length===0){v("No Pages","There are no pages to export.","info");return}G("export-pdf-btn",async()=>{await be()})}}),document.getElementById("add-blank-page-btn")?.addEventListener("click",()=>{y||(m(),pe())}),document.getElementById("undo-btn")?.addEventListener("click",()=>{if(y)return;const n=R.pop();if(n){const e={allPages:c.map(a=>({...a})),selectedPages:Array.from(d),splitMarkers:Array.from(b)};q.push(e),O(n)}}),document.getElementById("redo-btn")?.addEventListener("click",()=>{if(y)return;const n=q.pop();if(n){const e={allPages:c.map(a=>({...a})),selectedPages:Array.from(d),splitMarkers:Array.from(b)};R.push(e),O(n)}}),document.getElementById("reset-btn")?.addEventListener("click",()=>{y?(E=!0,setTimeout(()=>M(),100)):M()}),document.getElementById("modal-close-btn")?.addEventListener("click",_),document.getElementById("modal")?.addEventListener("click",n=>{n.target===document.getElementById("modal")&&_()});const t=document.getElementById("upload-area");t&&(t.addEventListener("dragover",n=>{n.preventDefault(),t.classList.add("border-indigo-500")}),t.addEventListener("dragleave",()=>{t.classList.remove("border-indigo-500")}),t.addEventListener("drop",n=>{n.preventDefault(),t.classList.remove("border-indigo-500");const e=Array.from(n.dataTransfer?.files||[]).filter(a=>a.type==="application/pdf");e.length>0&&Y(e)})),document.getElementById("upload-area")?.classList.remove("hidden")}function M(){E=!0,y=!1,m(),c=[],d.clear(),b.clear(),x=[],le.clear(),Z(),k&&(k.destroy(),k=null);const t=document.getElementById("pages-container");t&&(t.innerHTML=""),P(),document.getElementById("upload-area")?.classList.remove("hidden")}async function de(t){const n=t.target,e=Array.from(n.files||[]);e.length>0&&await Y(e),n.value=""}async function Y(t){if(y){v("Please Wait","Pages are still being rendered. Please wait...","info");return}const n=document.getElementById("upload-area");n&&n.classList.add("hidden");const e=document.getElementById("pages-container");if(e){y=!0,console.log("PDF Multi Tool: Starting render, isRendering set to true"),E=!1,Z(),U(0,100);try{for(const a of t){if(E)break;try{const o=await a.arrayBuffer(),r=await A.load(o);x.push(r);const i=x.length-1,s=await r.save(),l=await K({data:new Uint8Array(s)}).promise,u=l.numPages,f=c.length;for(let p=0;p<u;p++)c.push({id:N(),pdfIndex:i,pageIndex:p,rotation:0,visualRotation:0,canvas:null,pdfDoc:r,originalPageIndex:p,fileName:a.name});await oe(l,e,(p,h)=>{const w=f+h-1;return c[w]&&(c[w].canvas=p),ee(p,w)},{batchSize:8,useLazyLoading:!0,lazyLoadMargin:"400px",onProgress:(p,h)=>{U(p,h)},onBatchComplete:()=>{L({icons:B})},shouldCancel:()=>E})}catch(o){console.error(`Failed to load PDF ${a.name}:`,o),v("Error",`Failed to load ${a.name}. The file may be corrupted.`,"error")}}E||(te(),L({icons:B}))}finally{X(),y=!1,console.log("PDF Multi Tool: Render finished/cancelled, isRendering set to false"),E&&(E=!1),c.length===0&&M()}}}function ee(t,n){const e=c[n];if(!e)return console.error(`Page data not found for index ${n}`),document.createElement("div");const a=document.createElement("div");a.className="bg-gray-800 rounded-lg border-2 border-gray-700 p-2 relative group cursor-move",a.dataset.pageIndex=n.toString(),a.dataset.pageId=e.id,a.dataset.pageNumber=(e.pageIndex+1).toString(),e.fileName&&(a.dataset.fileName=e.fileName),e.canvas||(a.dataset.lazyLoad="true"),d.has(n)&&a.classList.add("border-indigo-500","ring-2","ring-indigo-500");const o=document.createElement("div");if(o.className="bg-white rounded mb-2 overflow-hidden w-full flex items-center justify-center relative h-36 sm:h-64",t){const g=t;g.className="max-w-full max-h-full object-contain",g.style.transform=`rotate(${e.visualRotation}deg)`,g.style.transition="transform 0.2s ease",o.appendChild(g)}else{const g=document.createElement("div");g.className="flex flex-col items-center justify-center text-gray-400",g.innerHTML=`
      <i data-lucide="loader" class="w-8 h-8 animate-spin mb-2"></i>
      <span class="text-xs">Loading...</span>
    `,o.appendChild(g),o.classList.add("bg-gray-700")}const r=document.createElement("div");r.className="text-xs text-gray-400 text-center mb-2",r.textContent=`Page ${n+1}`;const i=document.createElement("div");i.className="flex items-center justify-center gap-1 sm:opacity-0 group-hover:opacity-100 transition-opacity absolute bottom-2 left-0 right-0";const s=document.createElement("div");s.className="flex items-center gap-1 bg-gray-900/90 rounded px-2 py-1",i.appendChild(s);const l=document.createElement("button");l.className="absolute top-2 right-2 p-1 rounded bg-gray-900/70 hover:bg-gray-800 z-10",l.innerHTML=d.has(n)?'<i data-lucide="check-square" class="w-4 h-4 text-indigo-400"></i>':'<i data-lucide="square" class="w-4 h-4 text-gray-200"></i>',l.onclick=g=>{g.stopPropagation(),z(n)};const u=document.createElement("button");u.className="p-1 rounded hover:bg-gray-700",u.innerHTML='<i data-lucide="rotate-cw" class="w-4 h-4 text-gray-300"></i>',u.onclick=g=>{g.stopPropagation(),S(n,90)};const f=document.createElement("button");f.className="p-1 rounded hover:bg-gray-700",f.innerHTML='<i data-lucide="rotate-ccw" class="w-4 h-4 text-gray-300"></i>',f.onclick=g=>{g.stopPropagation(),S(n,-90)};const p=document.createElement("button");p.className="p-1 rounded hover:bg-gray-700",p.innerHTML='<i data-lucide="copy" class="w-4 h-4 text-gray-300"></i>',p.title="Duplicate this page",p.onclick=g=>{g.stopPropagation(),m(),F(n)};const h=document.createElement("button");h.className="p-1 rounded hover:bg-gray-700",h.innerHTML='<i data-lucide="trash-2" class="w-4 h-4 text-red-400"></i>',h.title="Delete this page",h.onclick=g=>{g.stopPropagation(),m(),H(n)};const w=document.createElement("button");w.className="p-1 rounded hover:bg-gray-700",w.innerHTML='<i data-lucide="file-plus" class="w-4 h-4 text-gray-300"></i>',w.title="Insert PDF after this page",w.onclick=g=>{g.stopPropagation(),m(),$(n)};const I=document.createElement("button");if(I.className="p-1 rounded hover:bg-gray-700",I.innerHTML='<i data-lucide="scissors" class="w-4 h-4 text-gray-300"></i>',I.title="Toggle split after this page",I.onclick=g=>{g.stopPropagation(),m(),j(n),C()},s.append(f,u,p,w,I,h),a.append(o,r,i,l),b.has(n)){const g=document.createElement("div");g.className="split-marker absolute -right-3 top-0 bottom-0 w-6 flex items-center justify-center z-20 pointer-events-none",g.innerHTML='<div class="h-full w-0.5 border-l-2 border-dashed border-blue-400"></div>',a.appendChild(g)}return a}function te(){const t=document.getElementById("pages-container");t&&(k&&k.destroy(),k=re.create(t,{animation:150,forceFallback:!0,touchStartThreshold:3,fallbackTolerance:3,delay:200,delayOnTouchOnly:!0,scroll:document.getElementById("main-scroll-container"),scrollSensitivity:100,bubbleScroll:!1,onEnd:n=>{const e=n.oldIndex,a=n.newIndex;if(e!==a){const[o]=c.splice(e,1);c.splice(a,0,o),we()}}}))}function z(t){d.has(t)?d.delete(t):d.add(t);const n=document.getElementById("pages-container");if(!n)return;const e=n.children[t];if(!e)return;const a=e.querySelector('button[class*="absolute top-2 right-2"]');a&&(d.has(t)?(e.classList.add("border-indigo-500","ring-2","ring-indigo-500"),a.innerHTML='<i data-lucide="check-square" class="w-4 h-4 text-indigo-400"></i>'):(e.classList.remove("border-indigo-500","ring-2","ring-indigo-500"),a.innerHTML='<i data-lucide="square" class="w-4 h-4 text-gray-200"></i>'),L({icons:B}))}function ge(){d.clear(),c.forEach((t,n)=>d.add(n)),P()}function ue(){d.clear(),P()}function S(t,n){m();const e=c[t];e.visualRotation=(e.visualRotation+n+360)%360,e.rotation=(e.rotation+n+360)%360;const a=document.getElementById("pages-container");if(!a)return;const o=a.children[t];if(!o)return;const r=o.querySelector("canvas"),i=o.querySelector(".bg-white");r&&i&&(r.style.transform=`rotate(${e.visualRotation}deg)`,r.style.transition="transform 0.2s ease")}function F(t){const n=c[t],e=n.canvas,a=document.createElement("canvas");a.width=e.width,a.height=e.height;const o=a.getContext("2d");o&&o.drawImage(e,0,0);const r={...n,id:N(),canvas:a},i=t+1;c.splice(i,0,r),P()}function H(t){c.splice(t,1),d.delete(t);const n=new Set;if(d.forEach(e=>{e>t?n.add(e-1):e<t&&n.add(e)}),d=n,c.length===0){M();return}P()}async function $(t){document.getElementById("insert-pdf-input")?.click(),window.__insertAfterIndex=t}async function fe(t){const n=t.target,e=n.files?.[0];if(!e)return;const a=window.__insertAfterIndex;if(a!==void 0){try{const o=await e.arrayBuffer(),r=await A.load(o);x.push(r);const i=x.length-1,s=await r.save(),l=await K({data:new Uint8Array(s)}).promise,u=l.numPages,f=[];for(let p=0;p<u;p++)f.push({id:N(),pdfIndex:i,pageIndex:p,rotation:0,visualRotation:0,canvas:null,pdfDoc:r,originalPageIndex:p,fileName:e.name});c.splice(a+1,0,...f),P();for(let p=0;p<u;p++){const h=a+1+p,w=await ie(l,p+1);if(c[h]){c[h].canvas=w;const g=document.getElementById("pages-container")?.querySelector(`div[data-page-index="${h}"]`);if(g){const D=g.querySelector(".bg-gray-700")||g.querySelector(".bg-white");if(D){D.innerHTML="",D.className="bg-white rounded mb-2 overflow-hidden w-full flex items-center justify-center relative h-36 sm:h-64";const T=w;T.className="max-w-full max-h-full object-contain",T.style.transform=`rotate(${c[h].visualRotation}deg)`,T.style.transition="transform 0.2s ease",D.appendChild(T)}}}}}catch(o){console.error("Failed to insert PDF:",o),v("Error","Failed to insert PDF. The file may be corrupted.","error")}n.value=""}}function j(t){b.has(t)?b.delete(t):b.add(t)}function C(){const t=document.getElementById("pages-container");t&&(t.querySelectorAll(".split-marker").forEach(n=>n.remove()),Array.from(t.children).forEach((n,e)=>{if(b.has(e)){const a=document.createElement("div");a.className="split-marker absolute -right-3 top-0 bottom-0 w-6 flex items-center justify-center z-20 pointer-events-none",a.innerHTML='<div class="h-full w-0.5 border-l-2 border-dashed border-blue-400"></div>',n.appendChild(a)}}))}function pe(){const t=document.createElement("canvas");t.width=595,t.height=842;const n=t.getContext("2d");n&&(n.fillStyle="white",n.fillRect(0,0,595,842));const e={id:N(),pdfIndex:-1,pageIndex:-1,rotation:0,visualRotation:0,canvas:t,pdfDoc:null,originalPageIndex:-1,fileName:""};c.push(e),P()}function J(t){if(d.size===0){v("No Selection","Please select pages to rotate.","info");return}d.forEach(n=>{const e=c[n];if(e){e.visualRotation=(e.visualRotation+t+360)%360,e.rotation=(e.rotation+t+360)%360;const o=document.getElementById("pages-container")?.querySelector(`div[data-page-index="${n}"]`);if(o){const r=o.querySelector("canvas");r&&(r.style.transform=`rotate(${e.visualRotation}deg)`)}}})}function me(){if(d.size===0){v("No Selection","Please select pages to delete.","info");return}if(Array.from(d).sort((n,e)=>e-n).forEach(n=>c.splice(n,1)),d.clear(),c.length===0){M();return}P()}function ye(){if(d.size===0){v("No Selection","Please select pages to duplicate.","info");return}Array.from(d).sort((n,e)=>e-n).forEach(n=>{F(n)}),d.clear(),P()}function he(){if(d.size===0){v("No Selection","Please select pages to mark for splitting.","info");return}Array.from(d).forEach(n=>{b.has(n)||b.add(n)}),C(),d.clear(),P()}async function be(){if(c.length===0){v("No Pages","Please upload PDFs first.","info");return}if(b.size>0)await ve();else{const t=Array.from({length:c.length},(n,e)=>e);await ne(t,"all-pages.pdf")}}async function ve(){try{const t=new se,n=Array.from(b).sort((r,i)=>r-i),e=[];let a=[];for(let r=0;r<c.length;r++)a.push(r),b.has(r)&&(e.push(a),a=[]);a.length>0&&e.push(a);for(let r=0;r<e.length;r++){const i=e[r],s=await A.create();for(const u of i){const f=c[u];if(!f){console.warn(`Page data missing for index ${u}`);continue}if(f.pdfDoc&&f.originalPageIndex>=0){const[p]=await s.copyPages(f.pdfDoc,[f.originalPageIndex]),h=s.addPage(p);if(f.rotation!==0){const w=h.getRotation().angle;h.setRotation(V(w+f.rotation))}}else s.addPage([595,842])}const l=await s.save();t.file(`document - ${r+1}.pdf`,l)}const o=await t.generateAsync({type:"blob"});Q(o,"split-documents.zip"),v("Success",`Downloaded ${e.length} PDF files in a ZIP archive.`,"success")}catch(t){console.error("Failed to create split PDFs:",t),v("Error","Failed to create split PDFs.","error")}finally{X()}}async function ne(t,n){try{const e=await A.create();for(const r of t){const i=c[r];if(!i){console.warn(`Page data missing for index ${r}`);continue}if(i.pdfDoc&&i.originalPageIndex>=0){const[s]=await e.copyPages(i.pdfDoc,[i.originalPageIndex]),l=e.addPage(s);if(i.rotation!==0){const u=l.getRotation().angle;l.setRotation(V(u+i.rotation))}}else e.addPage([595,842])}const a=await e.save(),o=new Blob([new Uint8Array(a)],{type:"application/pdf"});Q(o,n),v("Success","PDF downloaded successfully.","success")}catch(e){console.error("Failed to create PDF:",e),v("Error","Failed to create PDF.","error")}}function P(){const t=document.getElementById("pages-container");if(!t)return;const n=new Map;Array.from(t.children).forEach(e=>{const a=e;a.dataset.pageId&&n.set(a.dataset.pageId,a)}),c.forEach((e,a)=>{let o=n.get(e.id);if(o){n.delete(e.id),t.children[a]!==o&&(a<t.children.length?t.insertBefore(o,t.children[a]):t.appendChild(o)),o.dataset.pageIndex=a.toString();const r=o.querySelector(".text-xs.text-gray-400.text-center.mb-2");r&&(r.textContent=`Page ${a+1} `);const i=o.querySelector('button[class*="absolute top-2 right-2"]');i&&(d.has(a)?(o.classList.add("border-indigo-500","ring-2","ring-indigo-500"),i.innerHTML='<i data-lucide="check-square" class="w-4 h-4 text-indigo-400"></i>'):(o.classList.remove("border-indigo-500","ring-2","ring-indigo-500"),i.innerHTML='<i data-lucide="square" class="w-4 h-4 text-gray-200"></i>'),i.onclick=u=>{u.stopPropagation(),z(a)});const s=o.querySelector("canvas");s&&(s.style.transform=`rotate(${e.visualRotation}deg)`);const l=o.querySelector(".flex.items-center.gap-1.bg-gray-900\\/90");if(l){const u=l.querySelectorAll("button");u[0]&&(u[0].onclick=f=>{f.stopPropagation(),S(a,-90)}),u[1]&&(u[1].onclick=f=>{f.stopPropagation(),S(a,90)}),u[2]&&(u[2].onclick=f=>{f.stopPropagation(),m(),F(a)}),u[3]&&(u[3].onclick=f=>{f.stopPropagation(),m(),$(a)}),u[4]&&(u[4].onclick=f=>{f.stopPropagation(),m(),j(a),C()}),u[5]&&(u[5].onclick=f=>{f.stopPropagation(),m(),H(a)})}}else o=ee(e.canvas,a),o.dataset.pageId=e.id,a<t.children.length?t.insertBefore(o,t.children[a]):t.appendChild(o)}),n.forEach(e=>e.remove()),te(),C(),L({icons:B})}function we(){const t=document.getElementById("pages-container");if(!t)return;Array.from(t.children).forEach((e,a)=>{e.dataset.pageIndex=a.toString();const o=e.querySelector(".text-xs.text-gray-400.text-center.mb-2");o&&(o.textContent=`Page ${a+1} `);const r=e.querySelector('button[class*="absolute top-2 right-2"]');r&&(r.onclick=s=>{s.stopPropagation(),z(a)});const i=e.querySelector(".flex.items-center.gap-1.bg-gray-900\\/90");if(i){const s=i.querySelectorAll("button");s[0]&&(s[0].onclick=l=>{l.stopPropagation(),S(a,-90)}),s[1]&&(s[1].onclick=l=>{l.stopPropagation(),S(a,90)}),s[2]&&(s[2].onclick=l=>{l.stopPropagation(),m(),F(a)}),s[3]&&(s[3].onclick=l=>{l.stopPropagation(),m(),$(a)}),s[4]&&(s[4].onclick=l=>{l.stopPropagation(),m(),j(a),C()}),s[5]&&(s[5].onclick=l=>{l.stopPropagation(),m(),H(a)})}})}
